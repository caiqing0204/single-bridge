# 文件上传阿里云oss
<!-- TOC -->

- [1. 什么是分片上传](#1-什么是分片上传)
- [2. 什么是断点续传](#2-什么是断点续传)
- [3. 常见问题](#3-常见问题)
  - [3.1. 上传同名文件是否会覆盖](#31-上传同名文件是否会覆盖)
  - [3.2. 移动端（钉钉微应用）上传时，出现少数机型分片上传功能失效](#32-移动端钉钉微应用上传时出现少数机型分片上传功能失效)
    - [3.2.1. 解决方案](#321-解决方案)
    - [3.2.2. 相关链接](#322-相关链接)

<!-- /TOC -->
## 1. 什么是分片上传

在需要上传的文件较大时，可以通过`multipartUpload`接口进行分片上传。分片上传的好处是将一个大请求分成多个小请求来执行，这样当其中一些请求失败后，不需要重新上传整个文件，而只需要上传失败的分片就可以了。一般对于大于100MB的文件，建议采用分片上传的方法。

## 2. 什么是断点续传

分片上传提供**progress**参数允许用户传递一个进度回调，在回调中SDK将当前已经**上传成功的比例**和**断点信息**作为参数**供前端使用**。为了实现断点上传，可以在上传过程中**保存断点信息**（checkpoint），**发生错误后，再将已保存的checkpoint作为参数传递给multipartUpload**，此时将从上次失败的地方继续上传。

```js
try {
      const result = await client.multipartUpload('object-name', filePath, {
        checkpoint,
        async progress(percentage, cpt) {
          checkpoint = cpt;
        },
      });
      console.log(result);
      // break if success
      break;
    } catch (e) {
      console.log(e);
}
```

上面的代码只是将checkpoint保存在变量中，如果程序崩溃的话就丢失了，用户也可以将它保存在文件中，然后在程序重启后将checkpoint信息从文件中读取出来。

## 3. 常见问题

### 3.1. 上传同名文件是否会覆盖

OSS允许上传同名文件，但是会对源文件直接执行覆盖操作

### 3.2. 移动端（钉钉微应用）上传时，出现少数机型分片上传功能失效

#### 3.2.1. 解决方案

实例化 OSS 选项的时候传入useFetch: false选项

#### 3.2.2. 相关链接

[h5 OSS上传 qq浏览器失败超时](https://www.jianshu.com/p/5f6d09c099b6)
